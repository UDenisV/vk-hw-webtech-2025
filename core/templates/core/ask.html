{% extends "core/base.html" %}
{% block title %}Ask a question{% endblock %}

{% block content %}
<h2>Ask a question</h2>
<form method="post" action="">
    {% csrf_token %}
    <div class="form-field">
        <label for="id_title">Heading:</label>
        <input type="text" id="id_title" name="title" maxlength="200" value="{{ title_input|default:'' }}">
        {% if form_errors_title %}
        <div class="error">
            {% for error in form_errors_title %}
                <p>{{ error }}</p>
            {% endfor %}
        </div>
        {% endif %}
    </div>

    <div class="form-field">
        <label for="id_detailed">Question text:</label>
        <textarea id="id_detailed" name="detailed">{{ detailed_input|default:'' }}</textarea>
        {% if form_errors_detailed %}
        <div class="error">
            {% for error in form_errors_detailed %}
                <p>{{ error }}</p>
            {% endfor %}
        </div>
        {% endif %}
    </div>

    <div class="form-field">
        <label for="id_tags">Tags (max 3, separated by ","):</label>
        <input type="text" id="id_tags" name="tags" placeholder="Add tags" value="{{ tags_input|default:'' }}">
        {% if form_errors_tags %}
        <div class="error">
            {% for error in form_errors_tags %}
                <p>{{ error }}</p>
            {% endfor %}
        </div>
        {% endif %}
    </div>

    <button type="submit">Add question</button>
</form>

<script>
$(function() {
    var availableTags = [
        {% for tag in tags %}"{{ tag.title }}"{% if not forloop.last %},{% endif %}{% endfor %}
    ];

    function split(val) { return val.split(/,\s*/); }
    function extractLast(term) { return split(term).pop(); }

    $("#id_tags").autocomplete({
        minLength: 1,
        source: function(request, response) {
            var term = extractLast(request.term);
            var matches = $.grep(availableTags, function(tag) {
                return tag.toLowerCase().indexOf(term.toLowerCase()) === 0;
            });
            response(matches);
        },
        focus: function() { return false; },
        select: function(event, ui) {
            var terms = split(this.value);
            terms.pop();
            terms.push(ui.item.value);
            terms.push("");
            this.value = terms.join(", ");
            return false;
        }
    });
});
</script>
{% endblock %}
